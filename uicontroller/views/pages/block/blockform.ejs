<%- include('../../partials/header.ejs',{ isMenuVisible : true, title: 'Block' }) %>
    <%- include('../../partials/aside.ejs') %>
        <main id="main" class="main">
            <div class="pagetitle">
                <h1>Block</h1>
                <nav>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">Home</li>
                        <li class="breadcrumb-item">Block</li>
                        <li class="breadcrumb-item active">Add</li>
                    </ol>
                </nav>
            </div><!-- End Page Title -->

            <section class="section">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Block form</h5>

                                <!-- Horizontal Form -->
                                <form>
                                    <div class="row mb-3">
                                        <label for="blockCode" class="col-sm-2 col-form-label">Block Code</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="blockCode">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label for="blockLocation" class="col-sm-2 col-form-label">Location</label>
                                        <div class="col-sm-10">
                                            <input type="email" class="form-control" id="blockLocation">
                                        </div>
                                    </div>
                                    <fieldset class="row mb-3">
                                        <legend class="col-form-label col-sm-2 pt-0">Status</legend>
                                        <div class="col-sm-10">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="status"
                                                    id="isActive" value="1" >
                                                <label class="form-check-label" for="isActive">
                                                    Active
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="status"
                                                    id="inActive" value="0">
                                                <label class="form-check-label" for="inActive">
                                                    InActive
                                                </label>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <div class="text-center">
                                        <input type="hidden" id="blockId" value="<%=blockId %>" />
                                        <button type="submit" onclick="saveOrUpdateBlock()" class="btn btn-primary"
                                            id="submitButton" disabled>Submit</button>
                                        <button type="reset" class="btn btn-secondary">Reset</button>
                                    </div>
                                </form><!-- End Horizontal Form -->
                            </div>
                        </div>
                        </div>
                    </div>
                </section>
                            <script>
                                var blockCode = document.getElementById('blockCode');
                                var blockLocation = document.getElementById('blockLocation');
                                var selectedStatus = document.querySelectorAll('input[name="status"]')
                                var submitButton = document.getElementById('submitButton');
                                var blockId = document.getElementById('blockId').value;

                                function getSelectedStatus() {
                                    let selectedStatusValue = null;
                                    selectedStatus.forEach(radio => {
                                        if (radio.checked) {
                                            selectedStatusValue = parseInt(radio.value);
                                        }
                                    });
                                    return selectedStatusValue;
                                }

                                function saveOrUpdateBlock() {
                                    const selectedStatusValue = getSelectedStatus();

                                    var myHeaders = new Headers();
                                    myHeaders.append("Content-Type", "application/json");

                                    var raw = JSON.stringify({
                                        "blockCode": blockCode.value,
                                        "blockLocation": blockLocation.value,
                                        "isActive": selectedStatusValue
                                    });

                                    var requestOptions = {
                                        method: blockId ? 'PUT' : 'POST',
                                        headers: myHeaders,
                                        body: raw
                                    };

                                    let url = "http://localhost:1000/api/block";
                                    if (blockId) {
                                        url = url + '/' + blockId
                                    }

                                    fetch(url, requestOptions)
                                        .then(response => response.text())
                                        .then(blocks => window.location = '/block')
                                        .catch(error => console.error('error', error));
                                }

                                if (blockId) {
                                    getBlock(blockId)
                                }

                                function getBlock(blockId) {
                                    const requestOptions = {
                                        method: "GET"
                                    };

                                    fetch("http://localhost:1000/api/block/" + blockId, requestOptions)
                                        .then((response) => response.json())
                                        .then((block) => {
                                            blockCode.value = block.blockCode
                                            blockLocation.value = block.blockLocation
                                            if (block.isActive) {
                                                document.getElementById('isActive').checked = true;
                                            } else {
                                                document.getElementById('inActive').checked = true;
                                            }
                                        })
                                        .catch((error) => console.error(error));
                                }

                                function toggleSubmitButton() {
                                    const selectedStatusValue = getSelectedStatus();
                                    submitButton.disabled = !(
                                        blockCode.value.length > 0 &&
                                        blockLocation.value.length > 0 &&
                                        selectedStatusValue !== null
                                    )
                                }

                                blockCode.addEventListener('input', toggleSubmitButton);
                                blockLocation.addEventListener('input', toggleSubmitButton);
                                document.querySelectorAll('input[name="status"]').forEach(radio => radio.addEventListener('change', toggleSubmitButton));
                            </script>
                            <%- include('../../partials/footer.ejs') %>