<%- include('../../partials/header.ejs',{ isMenuVisible : true, title: 'Room' }) %>
    <h2>Room</h2>
    <div class="form-group">
        <label for="blockCode">Block Code</label>
        <select class="form-control" id="blockCode">
            <option selected>Select</option>
        </select>
    </div>
    <div class="form-group">
        <label for="floorNumber">Floor Number</label>
        <select class="form-control" id="floorNumber">
            <option selected>Select</option>
        </select>
    </div>
    <div class="form-group">
        <label for="roomNumber">Room Number</label>
        <input type="number" class="form-control" id="roomNumber">
    </div>
    <div class="form-group">
        <label for="roomCapacity">Room Capacity</label>
        <input type="number" class="form-control" id="roomCapacity">
    </div>
    <div class="form-group">
        <label for="status">Status</label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="status" id="isActive" value="1">
            <label class="form-check-label" for="isActive">Active</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="status" id="inActive" value="0">
            <label class="form-check-label" for="inActive">Inactive</label>
        </div>
    </div>
    <div class="form-group">
        <label for="airConditioner">Air Conditioner</label><br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="isAirConditioner" id="isAir" value="1">
            <label class="form-check-label" for="isAir">Active</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="isAirConditioner" id="notAir" value="0">
            <label class="form-check-label" for="notAir">Inactive</label>
        </div>
    </div>
    <div class="submission">
        <input type="hidden" id="roomId" value="<%=roomId %>" />
        <button onclick="saveOrUpdateRoom()" class="btn btn-success" id="submitButton" disabled>Submit</button>
    </div>
    <%- include('../../partials/footer.ejs') %>
        <script>
            var blockCode = document.getElementById('blockCode');
            var floorNumber = document.getElementById('floorNumber');
            var roomNumber = document.getElementById('roomNumber');
            var roomCapacity = document.getElementById('roomCapacity');
            var submitButton = document.getElementById('submitButton');
            var roomId = document.getElementById('roomId').value;

            function saveOrUpdateRoom() {
                var selectedStatus = document.querySelector('input[name="status"]:checked');
                var isAirConditioner = document.querySelector('input[name="isAirConditioner"]:checked');

                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                var raw = JSON.stringify({
                    "blockId": blockCode.value,
                    "blockFloorId": floorNumber.value,
                    "roomNumber": parseInt(roomNumber.value),
                    "roomCapacity": parseInt(roomCapacity.value),
                    "isActive": parseInt(selectedStatus.value),
                    "isAirConditioner": parseInt(isAirConditioner.value)
                });

                var requestOptions = {
                    method: roomId ? 'PUT' : 'POST',
                    headers: myHeaders,
                    body: raw
                };

                let url = "http://localhost:1000/api/room";
                if (roomId) {
                    url = url + '/' + roomId
                }

                fetch(url, requestOptions)
                    .then(response => response.text())
                    .then(rooms => window.location = '/room')
                    .catch(error => console.error('error', error));
            }

            function populateBlockCode() {
                fetch("http://localhost:1000/api/block")
                    .then(response => response.json())
                    .then(responseData => {
                        const { blocks } = responseData
                        var optionsList = '<option selected>Select</option>'
                        for (var i = 0; i < blocks.length; i++) {
                            var opt = blocks[i]
                            optionsList += `<option value="${opt.blockId}">${opt.blockCode}</option>`
                        }
                        blockCode.innerHTML = optionsList
                    })
                    .catch(error => console.log('error', error));
            }

            function populateFloorNumber() {
                fetch("http://localhost:1000/api/blockfloor")
                    .then(response => response.json())
                    .then(responseData => {
                        const { blockFloors } = responseData
                        var optionsList = '<option selected>Select</option>'
                        for (var i = 0; i < blockFloors.length; i++) {
                            var opt = blockFloors[i]
                            optionsList += `<option value="${opt.blockFloorId}">${opt.floorNumber}</option>`
                        }
                        floorNumber.innerHTML = optionsList
                    })
                    .catch(error => console.log('error', error));
            }

            // populateBlockCode()
            // populateFloorNumber()

            // if (roomId) {
            //     getRoomById(roomId)
            // }

            function getRoomById(roomId) {
                const requestOptions = {
                    method: "GET",
                };

                fetch("http://localhost:1000/api/room/" + roomId, requestOptions)
                    .then((response) => response.json())
                    .then((room) => {
                        blockCode.value = room.blockId
                        floorNumber.value = room.blockFloorId
                        roomNumber.value = room.roomNumber
                        roomCapacity.value = room.roomCapacity

                        if (room.isActive) {
                            document.getElementById('isActive').checked = true;
                        } else {
                            document.getElementById('inActive').checked = true;
                        }

                        if (room.isAirConditioner) {
                            document.getElementById('isAir').checked = true;
                        } else {
                            document.getElementById('notAir').checked = true;
                        }

                    })
                    .catch((error) => console.error(error));
            }

            function toggleSubmitButton() {
                var selectedStatus = document.querySelector('input[name="status"]:checked');
                var isAirConditioner = document.querySelector('input[name="isAirConditioner"]:checked');

                submitButton.disabled = !(
                    blockCode.value !== 'Select' &&
                    floorNumber.value !== 'Select' &&
                    roomNumber.value.length > 0 &&
                    roomCapacity.value.length > 0 &&
                    selectedStatus !== null &&
                    isAirConditioner !== null
                )
            }

            // blockCode.addEventListener('input', toggleSubmitButton);
            // floorNumber.addEventListener('input', toggleSubmitButton);
            // roomNumber.addEventListener('input', toggleSubmitButton);
            // roomCapacity.addEventListener('input', toggleSubmitButton);
            // document.querySelectorAll('input[name="status"]').forEach(radio => radio.addEventListener('change', toggleSubmitButton));
            // document.querySelectorAll('input[name="isAirConditioner"]').forEach(radio => radio.addEventListener('change', toggleSubmitButton));
        function initializeForm() {
        let promises = [populateBlockCode(), populateFloorNumber()];

        if (roomId) {
            promises.push(getRoomById(roomId));
        }

        Promise.all(promises)
            .then(() => {
            blockCode.addEventListener('input', toggleSubmitButton);
            floorNumber.addEventListener('input', toggleSubmitButton);
            roomNumber.addEventListener('input', toggleSubmitButton);
            roomCapacity.addEventListener('input', toggleSubmitButton);
            document.querySelectorAll('input[name="status"]').forEach(radio => radio.addEventListener('change', toggleSubmitButton));
            document.querySelectorAll('input[name="isAirConditioner"]').forEach(radio => radio.addEventListener('change', toggleSubmitButton));
            })
            .catch(error => console.error('Error initializing form:', error));
    }

    initializeForm();

        </script>
        